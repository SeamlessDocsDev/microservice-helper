{"version":3,"sources":["../lib/handler.js"],"names":["handle","errors","require","id","err","key","replace","undefined","e","Error","code","stack","isJoi","handleJoi","oldError","joiError","badParams","receivedMessage","_object","details","forEach","detail","push","path","msg","message","type"],"mappings":";;;;;QAIgBA,M,GAAAA,M;;AAJhB;;;;;;AAEA,IAAMC,SAASC,0CAAf;;AAEO,SAASF,MAAT,CAAiBG,EAAjB,EAAqBC,GAArB,EAA0B;;AAE/B,MAAIC,MAAMF,GAAGG,OAAH,CAAW,IAAX,EAAiB,EAAjB,CAAV;;AAEA,MAAIL,OAAOI,GAAP,KAAeE,SAAnB,EAA8B,OAAOP,OAAO,cAAP,EAAuBI,GAAvB,CAAP;;AAE9B,MAAII,IAAK,IAAIC,KAAJ,CAAUR,OAAOI,GAAP,CAAV,CAAT;AACAG,IAAEE,IAAF,SAAaL,GAAb;;AAEA,MAAID,GAAJ,EAAS;;AAEPI,MAAEG,KAAF,GAAUP,IAAIO,KAAd;;AAEA,QAAIP,IAAIQ,KAAR,EAAe;AACbC,gBAAUT,GAAV,EAAeI,CAAf;AACD,KAFD,MAEO;AACLA,QAAEM,QAAF,GAAaV,GAAb;AACD;AACF;;AAED,SAAOI,CAAP;AACD;;AAED,SAASK,SAAT,CAAoBE,QAApB,EAA8BP,CAA9B,EAAiC;AAC/BA,IAAEQ,SAAF,GAAoB,EAApB;AACAR,IAAES,eAAF,GAAoBF,SAASG,OAA7B;AACAH,WAASI,OAAT,CAAiBC,OAAjB,CAAyB,UAACC,MAAD,EAAY;;AAEnCb,MAAEQ,SAAF,CAAYM,IAAZ,CACE;AACEjB,WAAOgB,OAAOE,IADhB;AAEEC,WAAOH,OAAOI,OAFhB;AAGEC,YAAOL,OAAOK;AAHhB,KADF;AAMD,GARD;AASD","file":"handler.js","sourcesContent":["import root from 'app-root-path'\n\nconst errors = require(`${root}/errors`)\n\nexport function handle (id, err) {\n\n  let key = id.replace(/^#/, \"\")\n\n  if (errors[key] == undefined) return handle('unknownError', err)\n\n  let e  = new Error(errors[key])\n  e.code = `#${key}`\n\n  if (err) {\n\n    e.stack = err.stack\n\n    if (err.isJoi) {\n      handleJoi(err, e)\n    } else {\n      e.oldError = err\n    }\n  }\n\n  return e\n}\n\nfunction handleJoi (joiError, e) {\n  e.badParams       = []\n  e.receivedMessage = joiError._object\n  joiError.details.forEach((detail) => {\n\n    e.badParams.push(\n      {\n        key  : detail.path,\n        msg  : detail.message,\n        type : detail.type\n      })\n  })\n}\n\n"]}